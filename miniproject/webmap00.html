<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>üìö ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

    <style>
        /* üé® ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á body */
        body {
            margin: 0;
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, #fefefb 0%, #e9e2d7 50%, #f5e9d9 100%); 
            animation: gradientShift 20s infinite alternate;
            overflow: hidden; 
        }

        /* üß± Container ‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î Layout ‡πÅ‡∏ö‡∏ö Grid */
        .grid-container {
            display: grid; 
            grid-template-columns: 1fr 4fr; /* ‚¨ÖÔ∏è ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô (83.33%) */
            grid-template-rows: 100%; 
            gap: 20px; 
            padding: 20px; 
            margin-top: 85px; 
            height: calc(100vh - 85px); 
            box-sizing: border-box;
            animation: fadeIn 1s ease-out;
        }

        /* üñºÔ∏è ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ç‡∏≠‡∏á iframe ‡πÅ‡∏•‡∏∞ Map */
        #map {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 20px; 
            background: #ffffff;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1), 0 0 0 1px rgba(0,0,0,0.05);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
        }
        
        #map:hover {
            transform: translateY(-5px); 
            box-shadow: 0 15px 35px rgba(0,0,0,0.2), 0 0 0 1px rgba(0,0,0,0.08); 
        }
        
        /* üí° Iframe Wrapper ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Title Overlay */
        .iframe-wrapper {
            position: relative;
            grid-column: 1 / 2;
            grid-row: 1 / 2;
            border-radius: 20px;
            overflow: hidden;
            background: #ffffff;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1), 0 0 0 1px rgba(0,0,0,0.05);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .iframe-wrapper:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2), 0 0 0 1px rgba(0,0,0,0.08);
        }

        /* üí° Title Overlay ‡∏ö‡∏ô iframe */
        .iframe-title {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, #918177, #63594f); 
            color: white;
            padding: 12px 20px;
            font-weight: 700;
            font-size: 16px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
            z-index: 100;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
        }

        /* üí° ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á iframe ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ï‡πâ Title Overlay */
        #iframeMenu {
            position: relative;
            top: 45px; 
            height: calc(100% - 45px);
            border-radius: 0; 
            box-shadow: none; 
            transition: none;
        }
        
        /* ‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ô Grid (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) */
        #map {
            grid-column: 2 / 3; 
            grid-row: 1 / 2; 
            z-index: 10;
        }

        /* üß≠ ‡πÅ‡∏ñ‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô (Navbar - ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 30px;
            padding: 15px 0;
            background: rgba(40, 30, 10, 0.9);
            backdrop-filter: blur(10px) saturate(180%);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 999;
            animation: slideDown 0.8s ease-out;
        }
        nav a {
            color: #fff;
            text-decoration: none;
            font-size: 15px;
            padding: 10px 18px;
            border-radius: 25px;
            transition: all 0.3s ease; 
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        nav a:hover {
            background: #f0c37f;
            color: #2d1e0a;
            box-shadow: 0 0 10px #f0c37f, 0 2px 5px rgba(0, 0, 0, 0.2);
            transform: scale(1.05); 
        }

        /* üí° Style ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Leaflet Controls */
        .leaflet-control-container .leaflet-control {
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border: none;
        }
        .leaflet-control-zoom-in, .leaflet-control-zoom-out, .leaflet-control-layers-toggle {
            border-radius: 8px !important;
        }
        .leaflet-popup-content-wrapper, .leaflet-tooltip {
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            font-family: 'Prompt', sans-serif;
        }
        .leaflet-popup-content b {
            color: #80795b;
        }


        /* üì± Responsive (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) */
        @media (max-width: 768px) {
            .grid-container {
                display: flex;
                flex-direction: column;
                margin-top: 130px; 
                height: auto;
            }

            .iframe-wrapper, #map {
                height: 300px;
                margin-bottom: 15px;
            }

            nav {
                flex-wrap: wrap;
                gap: 10px;
                padding: 10px 5px;
            }

            nav a {
                font-size: 14px;
                padding: 8px 14px;
            }
        }

        /* Custom Star Icon CSS (‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏á‡∏≤) */
        .custom-star-icon .fa-star {
            color: #ff4e6c;
            font-size: 18px; 
        }

        /* ü™Ñ Animation Keyframes (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>

<body>

    <nav>
    <a href="me000.html">üè† HOME</a>
    <a href="me00.html">üôã‚Äç‚ôÄÔ∏è ALL ME</a>
    <a href="me01.html">üåç WHAT IS GEOGRAPHY?</a>
    <a href="me02.html">üß† CHANGING THINKING</a>
    <a href="webmap00.html">üó∫Ô∏è AGI STUDENT</a>
    <a href="trip.html">üèûÔ∏è HIKING MAPS</a>
    <a href="miniprojcet.html">üõ∞Ô∏è ALL MAP</a>
    </nav>

    <div class="grid-container">
        <div class="iframe-wrapper">
            <div class="iframe-title">üîç ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</div>
            <iframe src="search.html" id="iframeMenu"></iframe>
        </div>
        
        <div id="map"></div>
    </div>

    <script>
        // *** 1. MAP AND LAYER SETUP ***
        // ‡∏õ‡∏£‡∏±‡∏ö Zoom Level ‡πÄ‡∏õ‡πá‡∏ô 6 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡∏π‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
        var map = L.map("map").setView([15.5, 100.3], 6); 
        var agiLayer = null; 
        var provinceLayer = null; 
        
        // **‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå GeoJSON ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î**
        const PROVINCE_GEOJSON_FILE = "thailand_province.geojson";
        // **‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠ Property ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢) ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå GeoJSON**
        const PROVINCE_NAME_PROP = 'prov_nam_t'; 

        // --- Base Layers (‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°) ---
        var baseLayers = {
            "üó∫Ô∏è ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (OSM)": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }),
            "üõ∞Ô∏è ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏° (Esri)": L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: 'Tiles &copy; Esri' }),
            "üèîÔ∏è ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏†‡∏π‡∏°‡∏¥‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® (Topo)": L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', { attribution: 'Map data ¬© OpenTopoMap contributors' })
        };
        baseLayers["üó∫Ô∏è ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (OSM)"].addTo(map);

        // *** ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î overlayLayers ‡πÅ‡∏•‡∏∞ L.control.layers ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö WMS Map ‡∏≠‡∏≠‡∏Å ***
        L.control.layers(baseLayers).addTo(map); // ‚¨ÖÔ∏è ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà Base Layers

        // --- Custom Icon (‡πÉ‡∏ä‡πâ CSS ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Style) ---
        var StarIcon = L.divIcon({
            className: 'custom-star-icon',
            html: '<i class="fa-solid fa-star"></i>', 
            iconSize: [20, 20],
            iconAnchor: [10, 10]
        });

        // *** 2. SEARCH DATA SETUP ***
        var uniqueData = { 'faculty': [], 'curriculum': [], 'province': [] };
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Autocomplete
        const autocompleteData = ["6716", "‡∏ì‡∏±‡∏ê‡∏ô‡∏¥‡∏ï‡∏¥", "‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏±‡∏ï‡∏ô‡πå", "‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å", "‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå", "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£", "‡∏Ñ‡∏ì‡∏∞‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå"];

        // *** 3. CORE FUNCTIONS ***

        function normalizeProvinceName(name) {
            if (!name) return '';
            let cleanedName = name.trim();
            if (cleanedName.startsWith('‡∏à.')) {
                cleanedName = cleanedName.substring(2).trim();
            }
            if (cleanedName.startsWith('‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î')) {
                cleanedName = cleanedName.substring(7).trim();
            }
            return cleanedName;
        }

        function getProvinceNameFromFeature(feature) {
            const rawName = feature.properties[PROVINCE_NAME_PROP];
            return normalizeProvinceName(rawName);
        }

        function updateResultCount(count) {
            const iframe = document.getElementById('iframeMenu');
            if (iframe && iframe.contentWindow) {
                iframe.contentWindow.postMessage({ type: 'updateCount', count: count }, '*');
            }
        }

        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Dropdown ‡πÉ‡∏ô search.html (‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°)
         */
        function updateDropdown(dropdownId, category) {
            const iframe = document.getElementById('iframeMenu'); 
            if (!iframe || !iframe.contentWindow) return;
            
            const dropdown = iframe.contentWindow.document.getElementById(dropdownId);
            const data = uniqueData[category] || []; 

            dropdown.innerHTML = '';
            
            let defaultOption = iframe.contentWindow.document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å${category === 'curriculum' ? '‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£' : category === 'faculty' ? '‡∏Ñ‡∏ì‡∏∞' : '‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î'}`;
            dropdown.appendChild(defaultOption);

            data.forEach(item => {
                let option = iframe.contentWindow.document.createElement('option');
                option.value = item;
                option.textContent = item;
                dropdown.appendChild(option);
            });
            
            dropdown.style.display = (category && data.length > 0) ? 'inline-block' : 'none';
            dropdown.value = '';
        }

        function loadProvinceBoundaries(provincesToHighlight, studentLayer) {
            if (provinceLayer) {
                map.removeLayer(provinceLayer);
            }
            
            function style(feature) {
                return {
                    fillColor: '#800026', 
                    weight: 3, 
                    opacity: 1,
                    color: '#c2185b', 
                    dashArray: '5',
                    fillOpacity: 0.15
                };
            }
            
            function filterProvinces(feature) {
                const normalizedProvinceName = getProvinceNameFromFeature(feature); 
                return provincesToHighlight.includes(normalizedProvinceName);
            }
            
            provinceLayer = new L.GeoJSON.AJAX(PROVINCE_GEOJSON_FILE, { 
                style: style,
                filter: filterProvinces, 
                onEachFeature: function (feature, layer) {
                    layer.bindTooltip(getProvinceNameFromFeature(feature), { permanent: false, direction: 'auto' });
                }
            });

            provinceLayer.addTo(map);
            
            if (provincesToHighlight.length > 0) {
                provinceLayer.on('data:loaded', function() {
                    let bounds = null;
                    const studentBounds = studentLayer.getBounds();
                    const provinceBounds = provinceLayer.getBounds();
                    
                    if (studentBounds.isValid() && provinceBounds.isValid()) {
                        bounds = studentBounds.extend(provinceBounds);
                    } else if (studentBounds.isValid()) {
                        bounds = studentBounds;
                    } 

                    if (bounds && bounds.isValid()) {
                        map.fitBounds(bounds, { padding: [30, 30] });
                    }
                });
            }
        }

        function loadGeoJSON(url) {
            if (agiLayer) {
                map.removeLayer(agiLayer);
            }
            if (provinceLayer) {
                map.removeLayer(provinceLayer);
            }

            let foundProvinces = new Set();
            
            agiLayer = new L.GeoJSON.AJAX(url, {
                pointToLayer: function (feature, latlng) {
                    return L.marker(latlng, { icon: StarIcon });
                },
                onEachFeature: function (feature, layer) {
                    const p = feature.properties;
                    if (p) {
                        foundProvinces.add(normalizeProvinceName(p.province)); 
                        
                        layer.bindPopup(
                            "<b>ID:</b> " + p.s_id + "<br>" +
                            "<b>Name:</b> " + p.s_name + "<br>" +
                            "<b>Faculty:</b> " + p.faculty + "<br>" +
                            "<b>Curriculum:</b> " + p.curriculum + "<br>" +
                            "<b>Province:</b> " + p.province
                        );
                    }
                }
            });

            agiLayer.addTo(map);

            agiLayer.on('data:loaded', function() {
                const count = agiLayer.getLayers().length;
                updateResultCount(count); 
                loadProvinceBoundaries(Array.from(foundProvinces), agiLayer);
                
                if (count === 0) {
                    map.setView([15.5, 100.3], 7); 
                }
            });
            
            agiLayer.on('loading', function() {
                updateResultCount('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...');
            });
        }
        
        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Autocomplete (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ postMessage)
         */
        function updateAutocomplete(data) {
            const iframe = document.getElementById('iframeMenu');
            if (!iframe || !iframe.contentWindow) return;
            
            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á iframeMenu
            iframe.contentWindow.postMessage({ type: 'autocomplete', data: data }, '*');
        }


        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• unique values ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á search.html ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Dropdown (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á Autocomplete Data)
         */
        function fetchUniqueValues() {
            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á (Mock data)
            uniqueData = {
                'faculty': ["‡∏Ñ‡∏ì‡∏∞‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°"],
                'curriculum': [
                    "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£", 
                    "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡πÅ‡∏ú‡∏ô 1 : ‡∏™‡∏´‡∏Å‡∏¥‡∏à‡∏®‡∏∂‡∏Å‡∏©‡∏≤)",
                    "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏á", 
                    "‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥", 
                    "‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°", 
                    "‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", 
                    "‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ä‡∏µ‡∏ß‡∏†‡∏≤‡∏û‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£", 
                    "‡∏™‡∏±‡∏ï‡∏ß‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏±‡∏ï‡∏ß‡πå"
                ], 
                'province': [
                    "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", "‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà", "‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", "‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå", "‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£", 
                    "‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", "‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤", "‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó", 
                    "‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥", "‡∏ä‡∏∏‡∏°‡∏û‡∏£", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏ï‡∏£‡∏±‡∏á", 
                    "‡∏ï‡∏£‡∏≤‡∏î", "‡∏ï‡∏≤‡∏Å", "‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å", "‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°", "‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°", 
                    "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤", "‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä", "‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå", "‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™", 
                    "‡∏ô‡πà‡∏≤‡∏ô", "‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨", "‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå", "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå", 
                    "‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", "‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ", "‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤", "‡∏û‡∏∞‡πÄ‡∏¢‡∏≤", "‡∏û‡∏±‡∏á‡∏á‡∏≤", 
                    "‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á", "‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£", "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å", "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ", "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå", 
                    "‡πÅ‡∏û‡∏£‡πà", "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", "‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°", "‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£", "‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô", 
                    "‡∏¢‡πÇ‡∏™‡∏ò‡∏£", "‡∏¢‡∏∞‡∏•‡∏≤", "‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î", "‡∏£‡∏∞‡∏ô‡∏≠‡∏á", "‡∏£‡∏∞‡∏¢‡∏≠‡∏á", 
                    "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ", "‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ", "‡∏•‡∏≥‡∏õ‡∏≤‡∏á", "‡∏•‡∏≥‡∏û‡∏π‡∏ô", "‡πÄ‡∏•‡∏¢", 
                    "‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©", "‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£", "‡∏™‡∏á‡∏Ç‡∏•‡∏≤", "‡∏™‡∏ï‡∏π‡∏•", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", 
                    "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£", "‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß", "‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ", 
                    "‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢", "‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå", "‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢", 
                    "‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π", "‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á", "‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç", "‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå", 
                    "‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ"
                ]
            };
            
            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á search.html
            setTimeout(() => {
                const iframe = document.getElementById('iframeMenu');
                if (iframe && iframe.contentWindow) {
                    iframe.contentWindow.postMessage({ 
                        type: 'initData', 
                        uniqueData: uniqueData,
                        // NEW: ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Autocomplete ‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö initData
                        autocompleteData: autocompleteData 
                    }, '*');
                }
            }, 500); 
        }

        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å search.html ‡πÅ‡∏•‡πâ‡∏ß‡πÇ‡∏´‡∏•‡∏î GeoJSON
         */
        function searchStudent() { 
            const iframeMenu = document.getElementById('iframeMenu');
            if (!iframeMenu || !iframeMenu.contentWindow) return;
            
            const searchInput = iframeMenu.contentWindow.document.getElementById('searchInput').value;
            const primaryValue = iframeMenu.contentWindow.document.getElementById('primaryValue').value;
            const areaValue = iframeMenu.contentWindow.document.getElementById('areaValue').value;

            let searchTerms = [];
            if (searchInput.trim() !== '') searchTerms.push(searchInput.trim());
            if (primaryValue.trim() !== '') searchTerms.push(primaryValue.trim());
            if (areaValue.trim() !== '') searchTerms.push(areaValue.trim());

            const keyword = searchTerms.join(' ');

            let url = `agi65.php?type=keyword&value=${encodeURIComponent(keyword)}`;
            loadGeoJSON(url);

            iframeMenu.contentWindow.postMessage({ 
                type: 'updateCount', 
                count: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...' 
            }, '*');
        }

        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡∏ï
         */
        function resetFilters() {
            loadGeoJSON("agi65.php?type=initial"); 
            
            const iframeMenu = document.getElementById('iframeMenu');
            if (iframeMenu && iframeMenu.contentWindow) {
                iframeMenu.contentWindow.postMessage({ type: 'resetForm' }, '*');
            }
        }
        
        // ******* ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏ü‡∏£‡∏° ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (Initialization) *******

        // Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å iframeMenu (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ search/reset ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)
        window.addEventListener("message", (event) => {
            if (event.data.action === 'search') {
                searchStudent();
            } else if (event.data.action === 'reset') {
                resetFilters();
            }
        });
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        fetchUniqueValues();
        loadGeoJSON("agi65.php?type=initial");
    </script>
</body>
</html>
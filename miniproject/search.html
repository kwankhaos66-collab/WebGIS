<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dropdown Search Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <style>
        /* üé® CSS ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà iframe */
        body { 
            font-family: 'Prompt', sans-serif;
            padding: 15px; 
            background-color: transparent; 
            /* ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏•‡∏ö margin ‡∏Ç‡∏≠‡∏á body ‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö iframe */
            margin: 0; 
        }
        
        .search-section { 
            padding: 5px; /* ‡∏•‡∏î Padding ‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
            text-align: left;
            background-color: transparent; 
            box-shadow: none;
            width: 100%; 
            max-width: none; 
            box-sizing: border-box;
            /* ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏õ‡πá‡∏ô auto ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á */
            height: auto; 
        }
        
        /* ‡∏õ‡∏£‡∏±‡∏ö Input ‡πÅ‡∏•‡∏∞ Select ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á */
        .search-section select,
        .search-section input[type="text"] {
            padding: 10px; /* ‡∏•‡∏î padding ‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
            font-size: 14px; /* ‡∏•‡∏î font size ‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
            border-radius: 8px; 
            border: 2px solid #ff85aa; 
            margin: 8px 0; 
            width: 100%; 
            max-width: none; 
            display: block; 
            margin-left: 0; 
            margin-right: 0; 
            box-sizing: border-box; 
            transition: all 0.3s ease;
        }
        .search-section input[type="text"]:focus,
        .search-section select:focus {
            border-color: #c2185b; 
            box-shadow: 0 0 5px rgba(194, 24, 91, 0.5);
            outline: none;
        }

        .search-section .filter-group {
            margin-bottom: 15px; /* ‡∏•‡∏î margin-bottom ‡∏•‡∏á */
            padding: 5px 0;
            border-bottom: 1px dashed #ff85aa;
        }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡∏ï */
        .search-section button {
            padding: 10px 15px;
            background-color: rgb(255, 91, 115) !important; 
            color: white !important; 
            border: none !important;
            border-radius: 5px !important;
            cursor: pointer !important;
            margin: 10px 5px; 
            font-weight: 700 !important;
            transition: background-color 0.3s, transform 0.2s;
            font-size: 14px; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏∏‡πà‡∏° */
        }
        .search-section button:hover {
            background-color: #c2185b !important; 
            transform: translateY(-1px);
        }
        /* Style ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° Reset */
        .search-section button:nth-of-type(2) { 
            background-color: #ffaec9 !important;
        }
        .search-section button:nth-of-type(2):hover {
            background-color: #ff899d !important;
        }


        #resultCount {
            margin-top: 15px;
            font-weight: 700;
            color: #4a4a4a; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ */
            font-size: 1.1em;
            text-align: center; 
            padding: 10px 0;
            border-top: 2px solid #c2185b; /* ‡πÄ‡∏ô‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡πâ‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏° */
            /* ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏•‡∏ö '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤' ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î HTML ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏™‡πà‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏ó‡∏ô */
        }
        
        .label {
            display: block;
            margin-top: 10px;
            margin-bottom: 5px;
            font-weight: 700;
            color: #c2185b;
            font-size: 14px; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î label */
        }
    </style>
</head>
<body>

    <div class="search-section">
        
        <div class="filter-group">
            <input
                list="searchSuggestions"
                type="text"
                id="searchInput"
                placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡∏£‡∏´‡∏±‡∏™, ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î"
                autocomplete="off"
            />
            <datalist id="searchSuggestions"></datalist>
        </div>

        <div class="filter-group">
            <span class="label">‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å (‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£)</span>
            <select id="primaryCategory" onchange="updatePrimaryCategory()"> 
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                <option value="curriculum">‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£</option>
            </select>
            <select id="primaryValue" style="display:none;"></select>
        </div>

        <div class="filter-group">
            <span class="label">‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</span>
            <select id="areaCategory" onchange="updateAreaCategory()"> 
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                <option value="province">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option> 
            </select>
            <select id="areaValue" style="display:none;"></select>
        </div>
        
        <div style="text-align: center; margin-top: 5px; margin-bottom: 5px;">
            <button onclick="searchStudent()"><i class="fas fa-search"></i> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            <button onclick="resetFilters()"><i class="fas fa-redo"></i> ‡∏£‡∏µ‡πÄ‡∏ã‡∏ï</button>
        </div>

        <div id="resultCount"><i class="fas fa-info-circle"></i> ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
        </div>
    
    <script>
        var globalUniqueData = {}; 

        function updateAutocompleteList(data) {
            const datalist = document.getElementById('searchSuggestions');
            datalist.innerHTML = ''; 
            data.forEach(item => {
                let option = document.createElement('option');
                option.value = item;
                datalist.appendChild(option);
            });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô updateDropdown ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏°‡πà (parent) 
        function updatePrimaryCategory() {
            const category = document.getElementById('primaryCategory').value;
            // ‡∏™‡πà‡∏á category ‡πÅ‡∏•‡∏∞ id ‡∏Ç‡∏≠‡∏á Dropdown ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏°‡πà
            if (window.parent && window.parent.updateDropdown) {
                window.parent.updateDropdown('primaryValue', category);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô updateDropdown ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏°‡πà (parent) 
        function updateAreaCategory() {
            const category = document.getElementById('areaCategory').value;
            // ‡∏™‡πà‡∏á category ‡πÅ‡∏•‡∏∞ id ‡∏Ç‡∏≠‡∏á Dropdown ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏°‡πà
            if (window.parent && window.parent.updateDropdown) {
                window.parent.updateDropdown('areaValue', category);
            }
        }
        
        function searchStudent() {
            if (window.parent) {
                window.parent.postMessage({ action: 'search' }, '*'); 
            }
        }

        function resetFilters() {
            if (window.parent) {
                window.parent.postMessage({ action: 'reset' }, '*'); 
            }
        }
        
        function resetForm() {
            document.getElementById('searchInput').value = '';
            document.getElementById('primaryCategory').value = '';
            document.getElementById('areaCategory').value = '';
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡πâ‡∏≤‡∏á Dropdown ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤
            const primaryValueDropdown = document.getElementById('primaryValue');
            primaryValueDropdown.style.display = 'none';
            primaryValueDropdown.innerHTML = ''; 
            
            const areaValueDropdown = document.getElementById('areaValue');
            areaValueDropdown.style.display = 'none';
            areaValueDropdown.innerHTML = '';
            
            document.getElementById('resultCount').innerHTML = '<i class="fas fa-info-circle"></i> ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤';
            
            updateAutocompleteList([]);
        }

        // Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏°‡πà (index.html)
        window.addEventListener('message', function(event) {
            const data = event.data;
            
            if (data.type === 'updateCount') {
                let countText;
                if (typeof data.count === 'number') {
                    countText = `<i class="fas fa-check-circle" style="color:#008000;"></i> ‡∏û‡∏ö ${data.count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                } else if (data.count === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...') {
                    countText = `<i class="fas fa-spinner fa-spin" style="color:#f0c37f;"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...`;
                } else {
                    countText = `<i class="fas fa-info-circle"></i> ${data.count}`;
                }
                document.getElementById('resultCount').innerHTML = countText;
            } else if (data.type === 'resetForm') {
                resetForm();
            } else if (data.type === 'initData' && data.uniqueData) {
                globalUniqueData = data.uniqueData;
                document.getElementById('resultCount').innerHTML = '<i class="fas fa-info-circle"></i> ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤';
                
                if (data.autocompleteData) {
                    updateAutocompleteList(data.autocompleteData);
                }
            } else if (data.type === 'autocomplete' && data.data) {
                updateAutocompleteList(data.data);
            }
        });
        
        resetForm(); 
    </script>
</body>
</html>